/*!CK:3884082277!*//*1440387960,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["clunI"]); }

__d('canUseReactEditor',['UserAgent'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';var i=typeof b.getSelection==='function',j=i&&((h.isPlatform('iOS')||h.isPlatform('Linux')||h.isPlatform('Mac OS X')||h.isPlatform('Windows')||h.isPlatform('Chrome OS'))&&(h.isBrowser('Chrome')||h.isBrowser('Edge >= 12')||h.isBrowser('Firefox >= 16')||h.isBrowser('IE >= 9')||h.isBrowser('Opera >= 12')||h.isBrowser('Mobile Safari >= 6')||h.isBrowser('Safari >= 5')));function k(){return j;}f.exports=k;},null);
__d('applyEmoticonToContentBlock',['CharacterMetadata','ComposedEntityMutability','ComposedEntityType','DocumentEntity','EmoticonsList','immutable'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();'use strict';var n=m.List,o='\u3000';function p(q,r,s){if(!l.emotes[r])return q;var t=k.create(j.EMOTICON,i.IMMUTABLE,{type:l.emotes[r],originalEmoticon:r}),u=q.getText(),v=q.getCharacterList(),w=r.length,x=v.get(s);return q.merge({text:u.slice(0,s)+o+u.slice(s+w),characterList:v.slice(0,s).concat(n.of(h.applyEntity(x,t)),v.slice(s+w))});}f.exports=p;},null);
__d('getTextAfterNearestEntity',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=j;while(k>0&&i.getEntityAt(k-1)===null)k--;return i.getText().slice(k,j);}f.exports=h;},null);
__d('applyEmoticonToContentState',['EmoticonsList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();'use strict';var k=new RegExp(h.regexp.source,'g');function l(m,n){var o=n.getAnchorKey(),p=n.getAnchorOffset(),q=m.getBlockForKey(o),r=j(q,p),s,t;while(t!==null){t=k.exec(r);if(t!==null)s=t;}if(!s)return m;var u=s[1];if(!u&&p!==r.length)return m;var v=s[2],w=p-r.length,x=w+s.index+s[1].length,y=m.getBlockMap().set(o,i(q,v,x));p-=v.length-1;return m.merge({blockMap:y,selectionBefore:n,selectionAfter:n.merge({anchorOffset:p,focusOffset:p})});}f.exports=l;},null);
__d('handleBeforeInputForEmoticon',['DocumentModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=new RegExp(/[\s'".,!?]/);function l(m,n){var o=m.getSelection();if(!o.isCollapsed()||!n||!k.test(n))return m;var p=m.getCurrentContent(),q=j(p,o);if(q===p)return m;var r=h.insertText(q,q.getSelectionAfter(),n);return i.push(m,r,'insert-characters');}f.exports=l;},null);
__d('handleSoftNewlineForEmoticon',['DocumentModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){var m=l.getCurrentContent(),n=l.getSelection(),o=j(m,n);if(o===m)return l;var p=h.splitBlock(o,o.getSelectionAfter());return i.push(l,p,'split-block');}f.exports=k;},null);
__d('isSoftNewlineEvent',['Keys'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';function i(j){return j.which===h.RETURN&&(j.getModifierState('Shift')||j.getModifierState('Alt')||j.getModifierState('Control'));}f.exports=i;},null);
__d('UFIMentionsInput.react',['Arbiter','BanzaiScuba','Bootloader','ComposedEntityMutability','ComposedEntityType','DocumentEntity','DocumentModifier','DOMVector','EditorState','Input','Keys','MentionsInput.react','React','ReactDOM','SelectionState','URI','canUseReactEditor','clickRefAction','createEditorStateWithEntities','createEmptyEditorState','createMentionEntity','cx','emptyFunction','getMentionsInputDecorator','getMentionsTextForContentState','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','isSoftNewlineEvent','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka){if(c.__markCompiled)c.__markCompiled();var la=new i('ufi_tinder',null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),ma=200,na='ufi_comment_composer',oa='ufi_reply_composer',pa=x();function qa(ua){var va=ua.map(function(wa){return {kind:'file',type:wa.type,getAsFile:da.thatReturns(wa)};});return {clipboardData:{items:va}};}function ra(ua){var va=/^image\//;return ua.filter(function(wa){return va.test(wa.type);});}var sa=t.createClass({displayName:'UFIMentionsInput',getInitialState:function(){var ua='',va=[];if(this.props.initialData){ua=this.props.initialData.value||'';va=this.props.initialData.mentions||[];va=va.map(function(xa){return babelHelpers._extends({},xa,{entity:{uid:xa.uid,weakreference:xa.weakreference}});});}var wa=z({text:ua,ranges:va,decorator:ea(),entityCreationFn:ta});wa=p.moveSelectionToEnd(wa);return {bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:wa,mentionsSource:null,mentionableEntries:null,fallbackText:ua};},hasEnteredText:function(){return !!this.state.editorState.getCurrentContent().getPlainText().trim();},focus:function(){this._triggerFullRender((function(){if(pa){this.refs.mentionsInput.focus();}else u.findDOMNode(this.refs.textarea).focus();}).bind(this));},submitComment:function(event){if(this._submitComment(event))this._clearDocumentState();},insertMention:function(ua){this._triggerFullRender((function(){if(pa){var va=this.state.editorState,wa=va.getSelection(),xa=va.getCurrentContent(),ya=wa.getStartKey(),za=wa.getStartOffset(),ab=xa.getBlockForKey(ya),bb;if(ab.getText().substr(za-1,1).trim().length>0){var cb=n.replaceText(xa,wa,' ');wa=cb.getSelectionAfter();bb=n.insertText(cb,wa,ua.getTitle(),va.getCurrentInlineStyle(),ba(ua));}else bb=n.replaceText(xa,wa,ua.getTitle(),va.getCurrentInlineStyle(),ba(ua));wa=bb.getSelectionAfter();bb=n.insertText(bb,wa,' ');va=p.push(va,bb,'insert-fragment');va=p.forceSelection(va,va.getSelection());this.setState({editorState:va});this.focus();}else{u.findDOMNode(this.refs.textarea).focus();if(this.state.fallbackText.length){this.setState({fallbackText:this.state.fallbackText+' '+ua.title});}else this.setState({fallbackText:ua.title});}}).bind(this));},insertEmoticon:function(ua){if(!pa){this.setState({fallbackText:this.state.fallbackText+' '+ua});return;}var va=this.state.editorState,wa=va.getCurrentContent(),xa=va.getSelection(),ya=wa.getBlockForKey(xa.getStartKey()).getText()[xa.getStartOffset()-1];if(ya&&ya!==' ')ua=' '+ua;var za=wa.getBlockForKey(xa.getEndKey()).getText()[xa.getEndOffset()];if(za&&za!==' ')ua+=' ';var ab=n.replaceText(va.getCurrentContent(),va.getSelection(),ua);va=p.push(va,ab,'insert-characters');va=p.forceSelection(va,va.getSelection());this.setState({editorState:va});},setSignature:function(ua){setTimeout((function(){var va=this.state.editorState,wa=va.getSelection(),xa=va.getCurrentContent(),ya=xa.getBlockMap().first(),za=ya.getKey();wa=new v({anchorKey:za,anchorOffset:0,focusKey:za,focusOffset:ua.length});xa=n.replaceText(xa,wa,ua);va=p.set(va,{currentContent:xa});this.setState({editorState:va});}).bind(this),0);},_informHeightChange:function(){if(this.props.monitorHeight)ka((function(){if(!this.isMounted())return;var ua=pa?u.findDOMNode(this.refs.mentionsInput):u.findDOMNode(this.refs.textarea),va=o.getElementDimensions(ua).y;if(va!==this._height){this._height=va;h.inform('ufi/inputHeightChanged',{node:ua});}}).bind(this));},_onChange:function(ua){this.setState({editorState:ua},this._informHeightChange);},_clearDocumentState:function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();var ua=aa(ea());this.setState({editorState:p.moveFocusToEnd(ua)});},_handleContentReturn:function(ua){if(ja(ua)){var va=ia(this.state.editorState);if(va===this.state.editorState){return false;}else{this.setState({editorState:va});return true;}}if(this._submitComment(ua)){this._clearDocumentState();return true;}return false;},_handleBeforeInput:function(ua){var va=ha(this.state.editorState,ua);if(va===this.state.editorState){return false;}else{this.setState({editorState:va});return true;}},_submitComment:function(ua){var va=this.state.editorState.getCurrentContent(),wa=ga(va),xa=fa(va),ya={visibleValue:wa,encodedValue:xa},za=q.getValue(u.findDOMNode(this.refs.proxyInput));if(za){var ab=new w(b.location.href);la.addNormal('path',ab.getPath());la.addNormal('proxy_value',za.substr(0,ma));la.post();}return this.props.onEnterSubmit(ya,ua);},_handleFiles:function(ua){var va=ra(ua);if(va.length){this.props.onPaste(qa(va));return true;}return false;},_handleDroppedFiles:function(ua,va){return this._handleFiles(va);},_handlePastedFiles:function(ua){return this._handleFiles(ua);},_onMentionsInputBlur:function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();h.inform('ufi/blur',{hasEnteredText:this.hasEnteredText()});},_onMentionsInputFocus:function(){if(!this.state.bootloaded&&!this._currentlyBootloading){this._currentlyBootloading=true;if(this.props.showBusinessTypeahead){j.loadModules(["TypeaheadMetricReporter","getBusinessMentionsSearchSource"],(function(ua,va){if(!this.isMounted())return;var wa=new ua({event_name:'tinder_mentions'});wa.sessionStart();var xa=va(wa,this.props.ftEntIdentifier);xa.bootstrap();this.setState({typeaheadReporter:wa,bootloaded:true,mentionsSource:xa},(function(){this._currentlyBootloading=false;}).bind(this));}).bind(this));}else j.loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],(function(ua,va){if(!this.isMounted())return;var wa=new ua({event_name:'tinder_mentions'});wa.sessionStart();var xa=va(this.props.datasource,wa,this.props.showHashtagTypeahead);xa.bootstrap();this.setState({typeaheadReporter:wa,bootloaded:true,mentionsSource:xa},(function(){this._currentlyBootloading=false;}).bind(this));}).bind(this));}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();h.inform('ufi/focus');},_onShowMentions:function(ua,va){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(ua.map(function(wa){return wa.getUniqueID();}));},_onAddMention:function(ua,va,wa){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(ua.getUniqueID(),ua.getType(),va,wa.button>=0);this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}},_onFallbackKeyDown:function(ua){if(ua.which!==r.RETURN)return;if(ja(ua)||!this.state.fallbackText.trim())return;ua.preventDefault();var va={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(va,ua))this.setState({fallbackText:''});},_onFallbackChange:function(ua){this.setState({fallbackText:ua.target.value});},_onFallbackBlur:function(ua){this.props.onBlur&&this.props.onBlur();},_onFallbackFocus:function(ua){this.props.onFocus&&this.props.onFocus();},_sortByRenderType:function(ua,va){var wa=ua.getAuxiliaryData().renderType,xa=va.getAuxiliaryData().renderType;if(wa===xa)return ua.getOrder()-va.getOrder();var ya=this.props.viewOptionsTypeObjectsOrder;return ya.indexOf(wa)-ya.indexOf(xa);},_triggerFullRender:function(ua){this.setState({fullRender:true},ua);},_triggerFullRenderWithoutCallback:function(){this._triggerFullRender();},_renderFallback:function(){return (t.createElement('div',null,t.createElement('textarea',{ref:'textarea',className:"UFIAddCommentInput _1os9",name:'add_comment_text',placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this._onFallbackKeyDown,onChange:this._onFallbackChange,onBlur:this._onFallbackBlur,onFocus:this._onFallbackFocus,value:this.state.fallbackText})));},_renderProxyInput:function(){if(!this.props.hideProxyInput){var ua="_1osa mentionsHidden";return (t.createElement('input',{className:ua,name:'add_comment_text',ref:'proxyInput',onFocus:this.focus,tabIndex:'-1'}));}},_renderDummy:function(){var ua="UFIAddCommentInput _1osb _1osc";return (t.createElement('div',{onFocus:this._triggerFullRenderWithoutCallback,onSelect:da,onClick:this._triggerFullRenderWithoutCallback,onTouchStart:this._triggerFullRenderWithoutCallback,onMouseOver:this._triggerFullRenderWithoutCallback},this._renderProxyInput(),t.createElement('div',{className:ua},this.props.placeholder)));},_onClickEditorContainer:function(ua){y('ufi',ua.target,null,'FORCE');},_renderMentionsInput:function(){var ua="UFIAddCommentInput _1osb",va=babelHelpers._extends({mentionSortFn:this.props.viewOptionsTypeObjectsOrder?this._sortByRenderType:null},this.props.viewProps);return (t.createElement('div',{onClick:this._onClickEditorContainer},this._renderProxyInput(),t.createElement(s,{ref:'mentionsInput',className:ua,editorState:this.state.editorState,onChange:this._onChange,mentionsSource:this.state.mentionsSource,typeaheadView:this.props.viewComponent,typeaheadViewProps:va,spellCheck:true,placeholder:this.props.placeholder,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,onFocus:this._onMentionsInputFocus,onBlur:this._onMentionsInputBlur,handleContentReturn:this._handleContentReturn,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,autoflip:this.props.autoflip,webDriverTestID:this.props.replyCommentID?oa:na})));},componentDidMount:function(){if(!pa){if(this.state.fallbackText)u.findDOMNode(this.refs.textarea).focus();}else if(this.state.editorState.getCurrentContent().hasText())ka((function(){this.isMounted()&&this.focus();}).bind(this));},render:function(){if(!pa)return this._renderFallback();if(!this.state.fullRender)return this._renderDummy();return this._renderMentionsInput();}});function ta(ua){return m.create(l.MENTION,k.IMMUTABLE,{id:ua.uid,isWeak:ua.weakreference});}f.exports=sa;},null);